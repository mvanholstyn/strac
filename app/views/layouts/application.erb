<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>strac</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <%= stylesheet_link_tag 'screen' %>
  <%= stylesheet_link_tag 'print', :media => :print %>
  <%= javascript_include_tag :defaults, :cache => "combined" %>
</head>
 
<body>
	<div id="notice"<%= flash[:notice].blank? ? ' style="display:none"' : "" %>><%= flash[:notice] %></div>
	<div id="error"<%= flash[:error].blank? ? ' style="display:none"' : "" %>><%= flash[:error] %></div>

<div id="wrapper">
<div id="innerwrapper">

	<div id="header">
		<!--
		<form action="">
			<input value="Search" />
		</form>
		-->
				
		<h1><%= link_to "strac", dashboard_path %></h1>
		<h2>agile project management</h2>
		
		<ul id="nav">
			<% if current_user -%>
			<li><%= link_to "<em>d</em>ashboard", dashboard_path, :accesskey => "d" %></li>
			<% restrict_to :crud_projects do -%>
			<li><%= link_to "<em>p</em>rojects", projects_path, :accesskey => "p" %></li>
			<% end -%>
			<% restrict_to :crud_users, :crud_companies_users do -%>
			<li><%= link_to "<em>u</em>sers", users_path, :accesskey => "u" %></li>
			<% end -%>
			<% restrict_to :crud_companies do -%>
			<li><%= link_to "<em>c</em>ompanies", companies_path, :accesskey => "c" %></li>
			<% end -%>
			<li><%= link_to "profile", profile_users_path %></li>
			<li><%= link_to "logout", logout_users_path, :method => :post %></li>
			<% end -%>
		</ul>
		
		<% if @project and @project.id -%>
		<ul id="subnav">
			<li><%= link_to "<em>o</em>verview", project_path( @project ), :accesskey => "o" %></li>
			<li><%= link_to "c<em>u</em>rrent iteration", current_iterations_path( @project ), :accesskey => "u" %></li>
			<li><%= link_to "<em>i</em>terations", iterations_path( @project ), :accesskey => "i" %></li>
			<li><%= link_to "<em>s</em>tories", stories_path( @project ), :accesskey => "s" %></li>
		</ul>
		<% end -%>
	</div>

	<% if current_user -%>
	<div id="sidebar">
		
		<% if @project and @project.id -%>
		<h2><%= @project.name %>: summary</h2>
		<table class="project_summary">
			<tr>
				<th>Total Points:</th>
				<td><%= @project.total_points %></td>
			</tr>
			<tr>
				<th>Completed Points:</th>
				<td><%= @project.completed_points %></td>
			</tr>
			<tr>
				<th>Remaining Points:</th>
				<td><%= @project.remaining_points %></td>
			</tr>
			<tr>
				<th>Completed Iterations:</th>
				<td><%= @project.iterations.size %></td>
			</tr>
			<tr>
				<th>Average Velocity:</th>
				<td><%= @project.average_velocity.floor %></td>
			</tr>
			<tr>
				<th>Estimated Remaining Iterations:</th>
				<td><%= @project.estimated_remaining_iterations.ceil %></td>
			</tr>
			<tr>
				<th>Estimated Completion Date:</th>
				<td><%= @project.estimated_completion_date %></td>
			</tr>
		</table>

		<h2><%= @project.name %>: iterations</h2>
		<ul>
			<% for iteration in @project.iterations.find( :all, :order => "start_date DESC" ) -%>
			<li>
				<%= link_to iteration.name, iteration_path( @project, iteration ) %>
				<% if @project.iterations.find_current == iteration -%>
					(<%= link_to "current", current_iterations_path( @project ) %>)
				<% end -%>
			</li>
			<% end -%>
		</ul>
		<% end -%>
		
		<h2 style="display: inline;">your projects</h2>
		<% restrict_to :crud_projects do -%>
		(<%= link_to "create", new_project_path %>)
		<% end -%>
		<ul>
			<% for project in ProjectPermission.find_all_projects_for_user( current_user ) -%>
			<li>
			  <%= link_to project.name, project_path( project ) %>
			  <% restrict_to :crud_projects do -%>	
			    (<%= link_to "edit", edit_project_path( project ) %>)
			  <% end -%>
			</li>
			<% end -%>
		</ul>
	</div>
	<% end -%>
		
	<div id="content">
		<%= yield %>
	</div>
		
	<div id="footer">
		&copy;2007 strac
	</div>
		
</div>
</div>

</body>
</html>